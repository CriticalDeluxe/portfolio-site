---
import { getEntry } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { skills } from "../../data/skills";

export async function getStaticPaths() {
  return skills.map((s) => ({ params: { slug: s.slug } }));
}

const { slug } = Astro.params;

const navSkill = skills.find((s) => s.slug === slug);
if (!navSkill) return new Response("Not found", { status: 404 });

const entry = await getEntry("skills", slug);

const title = entry?.data.title ?? navSkill.title;
const lede = entry?.data.lede ?? "Page in progress.";
const gallery = entry?.data.gallery ?? [];

const Content = entry ? (await entry.render()).Content : null;
---

<BaseLayout title={title}>
  <main>
    <nav class="crumbs">
      <a href="/">Home</a>
      <span aria-hidden="true">/</span>
      <a href="/skills">Skills</a>
      <span aria-hidden="true">/</span>
      <span>{title}</span>
    </nav>

    <header>
      <div class="title-row">
        <img class="icon" src={navSkill.icon} alt="" width="36" height="36" loading="lazy" />
        <h1>{title}</h1>
      </div>
      <p class="lede">{lede}</p>
    </header>

    <section class="content">
      {Content ? <Content /> : <p class="muted">Content coming soon.</p>}
    </section>

    <section>
      <h2>Gallery</h2>

      {gallery.length === 0 ? (
        <p class="muted">
          No images yet. Add files under <code>public/gallery/{navSkill.slug}/</code> and list
          them in <code>skillPages.ts</code>.
        </p>
      ) : (
        <div class="gallery">
          {gallery.map((g) => (
            <figure class="tile">
              <img src={g.src} alt={g.alt} loading="lazy" />
              {g.caption && <figcaption>{g.caption}</figcaption>}
            </figure>
          ))}
        </div>
      )}
    </section>
  </main>
</BaseLayout>

<style>
  .content :global(h2) {
    margin-top: 2rem;
  }

  .content :global(p),
  .content :global(li) {
    max-width: 75ch;
  }

  .crumbs {
    display: flex;
    gap: 0.5rem;
    flex-wrap: wrap;
    margin-bottom: 1.5rem;
    font-size: 0.95rem;
  }

  .title-row {
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .icon {
    width: 36px;
    height: 36px;
  }

  .lede {
    font-size: 1.1rem;
    max-width: 70ch;
    margin-top: 0.75rem;
    opacity: 0.9;
  }

  .steps {
    padding-left: 1.25rem;
  }

  .steps li {
    margin: 1rem 0;
  }

  .steps h3 {
    margin: 0 0 0.25rem 0;
  }

  .muted {
    opacity: 0.85;
  }

  .gallery {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 1rem;
    margin-top: 1rem;
  }

  .tile {
    border: 1px solid rgba(148, 163, 184, 0.25);
    border-radius: 8px;
    padding: 0.75rem;
    margin: 0;
    background: rgba(15, 23, 42, 0.45);
  }

  .tile img {
    width: 100%;
    height: auto;
    border-radius: 6px;
    display: block;
    margin-bottom: 0.5rem;
  }
</style>
